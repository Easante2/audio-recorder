<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Send Mission Brief</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full">
      <h2 class="text-3xl font-bold text-center mb-6 text-gray-800">Send Mission Brief</h2>
      <div class="space-y-4">
        <!-- Submission Form -->
        <form id="recordingForm" class="space-y-4" novalidate>
          <div>
            <label for="nameInput" class="block text-sm font-medium text-gray-700 mb-1">Enter your name</label>
            <input 
              type="text" 
              id="nameInput" 
              name="name"
              pattern="[A-Za-z\s]+" 
              title="Please enter letters only" 
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              required
            >
            <div class="text-red-500 text-xs mt-1 hidden" id="nameError">Please enter a valid name (letters only)</div>
          </div>
          <div>
            <label for="emailInput" class="block text-sm font-medium text-gray-700 mb-1">
              Enter your email
            </label>
            <input 
              type="email" 
              id="emailInput" 
              name="email"
              class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
              required
              oninput="validateEmail(this)"
            >
            <div class="text-red-500 text-xs mt-1 hidden" id="emailError">
              Please enter a valid email address
            </div>
          </div>
                   
        </form>

        <!-- Recording Controls -->
        <div class="space-y-4">
          <div class="flex justify-center space-x-4">
            <button
              id="startRecord"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full flex items-center transition duration-300"
            >
              <i class="fas fa-microphone mr-2"></i> Start Recording
            </button>
            <button
              id="stopRecord"
              class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full flex items-center transition duration-300"
              disabled
            >
              <i class="fas fa-stop-circle mr-2"></i> Stop Recording
            </button>
          </div>
          <p id="timestamp" class="text-center text-sm text-gray-600"></p>
          <p id="recordingTime" class="text-center text-xl font-semibold text-gray-800"></p>
          <div class="mt-6">
            <h5 class="text-lg font-semibold mb-2 text-gray-700">Recorded Audio Preview:</h5>
            <audio id="audioPlayback" controls class="w-full"></audio>
          </div>
          <a
            id="downloadLink"
            class="hidden bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-full flex items-center justify-center transition duration-300"
          >
            <i class="fas fa-download mr-2"></i> Download Recording
          </a>
          <button
            type="submit"
            id="submitRecording"
            class="hidden bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-full flex items-center justify-center transition duration-300 w-full mt-2"
          >
            <i class="fas fa-paper-plane mr-2"></i> Submit Recording
          </button>
        </form>
      </div>
    </div>

    <script src="audio-recorder.js" defer></script>
    <script>
      function validateEmail(input) {
        const email = input.value.trim();
        const emailError = document.getElementById('emailError');
        
        // This pattern requires at least one period after @
        const emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$/;
        
        // Check if email has at least one period after @
        const hasValidDomain = email.split('@')[1]?.includes('.');
        
        if (!emailPattern.test(email) || !hasValidDomain) {
          input.setCustomValidity('Please enter a valid email address (e.g., user@example.com)');
          emailError.classList.remove('hidden');
        } else {
          input.setCustomValidity('');
          emailError.classList.add('hidden');
        }
      }

      // Also validate on form submission
      document.addEventListener('DOMContentLoaded', () => {
        const form = document.querySelector('form');
        if (form) {
          form.addEventListener('submit', (e) => {
            const emailInput = document.getElementById('emailInput');
            if (emailInput) {
              validateEmail(emailInput);
              if (!emailInput.validity.valid) {
                e.preventDefault();
              }
            }
          });
        }
      });
    </script>
  </body>
</html>
